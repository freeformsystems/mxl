#!/usr/bin/env node

var husk = require('husk')
  .exec().fs()
  .plugin([
    require('husk-parse'),
    require('husk-stringify'),
  ]);

var input = 'package.json';

// enable tmux exec method
husk.command('tmux');

// process input file
husk(input)
  .read()
  // parse as json and assign
  .parse({field: 'body'}, function(){return this.body})
  .async(function(cb) {
    var tmux = this.body.tmux;
    if(!Array.isArray(tmux)) {
      return cb(); 
    }
    var h = husk();
    tmux.forEach(function(cmd) {
      var args = Array.isArray(cmd) ? cmd : (cmd || '').split(/\s+/);
      console.log('tmux %s', cmd);
      h = h.tmux.apply(h, args);
    })
    h.run(cb);
  })
  .run();
